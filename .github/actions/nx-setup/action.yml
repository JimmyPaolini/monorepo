name: NX Setup
description: Self-contained Nx monorepo setup with pnpm, node, and cache management

runs:
  using: composite
  steps:
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    # Centralized version management - update here to upgrade all workflows
    - name: ğŸ“¦ Setup pnpm
      uses: pnpm/action-setup@v4
      with:
        version: 10.20.0
      shell: bash

    - name: ğŸŸ¢ Setup node
      uses: actions/setup-node@v4
      with:
        node-version: 22.20.0
        cache: pnpm
      shell: bash

    - name: ğŸ¯ Set NX SHAs
      uses: nrwl/nx-set-shas@v4
      shell: bash

    - name: â™»ï¸ Restore/Save Nx cache
      uses: actions/cache@v4
      with:
        path: .nx/cache
        key: nx-cache-${{ runner.os }}-${{ hashFiles('**/pnpm-lock.yaml') }}-${{ github.sha }}
        restore-keys: |
          nx-cache-${{ runner.os }}-${{ hashFiles('**/pnpm-lock.yaml') }}-
          nx-cache-${{ runner.os }}-
      shell: bash

    - name: ğŸ“š Install dependencies
      run: pnpm install --frozen-lockfile
      shell: bash
