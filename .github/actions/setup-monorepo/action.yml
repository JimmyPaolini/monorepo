name: ğŸ•‹ Setup Monorepo
description: Nx monorepo setup with pnpm, node, and cache management (requires checkout first)

runs:
  using: composite
  steps:
    # Centralized version management - update here to upgrade all workflows
    - name: ğŸ“¦ Setup pnpm
      uses: pnpm/action-setup@v4
      with:
        version: 10.20.0

    - name: ğŸŸ¢ Setup node
      uses: actions/setup-node@v4
      with:
        node-version: 22.20.0
        cache: pnpm

    - name: ğŸ¯ Set NX SHAs
      uses: nrwl/nx-set-shas@v4

    - name: ğŸ”§ Setup Homebrew
      uses: Homebrew/actions/setup-homebrew@master

    - name: ğŸ“„ Install yamllint
      run: brew install yamllint
      shell: bash

    - name: â™»ï¸ Restore/Save Nx cache
      uses: actions/cache@v4
      with:
        path: .nx/cache
        key: nx-cache-${{ runner.os }}-${{ hashFiles('**/pnpm-lock.yaml') }}-${{ github.sha }}
        restore-keys: |
          nx-cache-${{ runner.os }}-${{ hashFiles('**/pnpm-lock.yaml') }}-
          nx-cache-${{ runner.os }}-

    - name: ğŸ“š Install Dependencies
      run: pnpm install --frozen-lockfile
      shell: bash
