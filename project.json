{
  "name": "monorepo",
  "$schema": "node_modules/nx/schemas/project-schema.json",
  "projectType": "application",
  "targets": {
    "audit": {
      "executor": "nx:run-commands",
      "options": {
        "command": "pnpm audit --audit-level=moderate"
      },
      "configurations": {
        "check": {
          "command": "pnpm audit --audit-level=moderate"
        },
        "write": {
          "command": "pnpm audit --fix"
        }
      },
      "defaultConfiguration": "check",
      "cache": false,
      "description": "Scan for security vulnerabilities (check) or auto-fix them (write)"
    },
    "check-lockfile": {
      "executor": "nx:run-commands",
      "options": {
        "command": "bash scripts/check-lockfile.sh",
        "cwd": "{projectRoot}"
      },
      "description": "Verify that pnpm-lock.yaml is in sync with package.json files"
    },
    "dependency-analysis": {
      "executor": "nx:run-commands",
      "options": {
        "commands": [
          "nx run monorepo:dependency-lint:{args.configuration}",
          "nx run monorepo:audit:{args.configuration}",
          "nx run monorepo:license-check"
        ],
        "cwd": "{projectRoot}"
      },
      "configurations": {
        "check": {
          "parallel": true
        },
        "write": {
          "parallel": false
        }
      },
      "defaultConfiguration": "check",
      "cache": false,
      "description": "Run all dependency management tools (audit, dependency-lint, license-check)"
    },
    "dependency-lint": {
      "executor": "nx:run-commands",
      "options": {
        "command": "ncu --workspaces --root"
      },
      "configurations": {
        "check": {
          "command": "ncu --workspaces --root"
        },
        "write": {
          "command": "ncu --workspaces --root -u && pnpm install"
        }
      },
      "defaultConfiguration": "check",
      "cache": false,
      "description": "Check for dependency updates (check) or update to latest versions (write)"
    },
    "format": {
      "executor": "nx:run-commands",
      "options": {
        "command": "prettier {args} --ignore-unknown .",
        "cwd": "{projectRoot}"
      },
      "configurations": {
        "check": {
          "command": "prettier {args} --check --ignore-unknown ."
        },
        "write": {
          "command": "prettier {args} --write --ignore-unknown ."
        }
      },
      "defaultConfiguration": "write",
      "cache": true,
      "description": "Format workspace root files with Prettier (excluding NX projects)"
    },
    "knip": {
      "executor": "nx:run-commands",
      "options": {
        "command": "NODE_OPTIONS='--import=tsx/esm' knip --workspace .",
        "cwd": "{projectRoot}"
      },
      "configurations": {
        "check": {
          "command": "NODE_OPTIONS='--import=tsx/esm' knip --workspace ."
        },
        "write": {
          "command": "NODE_OPTIONS='--import=tsx/esm' knip --fix --workspace ."
        }
      },
      "defaultConfiguration": "check",
      "cache": true,
      "description": "Check for unused files, dependencies, and exports in workspace root only"
    },
    "license-check": {
      "executor": "nx:run-commands",
      "options": {
        "command": "license-checker --json --onlyAllow 'MIT;Apache-2.0;BSD-2-Clause;BSD-3-Clause;ISC;0BSD;CC0-1.0;Unlicense;Python-2.0;CC-BY-3.0;CC-BY-4.0' --production --excludePrivatePackages",
        "cwd": "{workspaceRoot}"
      },
      "cache": true,
      "inputs": [
        "default",
        "{workspaceRoot}/package.json",
        "{workspaceRoot}/pnpm-lock.yaml",
        "{workspaceRoot}/.license-checker.json"
      ],
      "description": "Check licenses of production dependencies"
    },
    "lint": {
      "executor": "nx:run-commands",
      "options": {
        "command": "eslint {args} --config eslint.config.base.ts --no-error-on-unmatched-pattern '*.ts' '*.js' '*.json' '*.md' 'scripts/' 'documentation/' 'infrastructure/'",
        "cwd": "{projectRoot}"
      },
      "configurations": {
        "check": {
          "command": "eslint {args} --config eslint.config.base.ts --no-error-on-unmatched-pattern '*.ts' '*.js' '*.json' '*.md' 'scripts/' 'documentation/' 'infrastructure/'"
        },
        "write": {
          "command": "eslint {args} --fix --config eslint.config.base.ts --no-error-on-unmatched-pattern '*.ts' '*.js' '*.json' '*.md' 'scripts/' 'documentation/' 'infrastructure/'"
        }
      },
      "defaultConfiguration": "check",
      "cache": true,
      "description": "Lint workspace root files (config files, scripts, documentation, infrastructure, markdown) excluding NX projects"
    },
    "markdown-lint": {
      "executor": "nx:run-commands",
      "options": {
        "command": "markdownlint-cli2 \"**/*.md\"",
        "cwd": "{workspaceRoot}"
      },
      "configurations": {
        "check": {
          "command": "markdownlint-cli2 \"**/*.md\""
        },
        "write": {
          "command": "markdownlint-cli2 --fix \"**/*.md\""
        }
      },
      "defaultConfiguration": "check",
      "cache": true,
      "inputs": [
        "default",
        "{workspaceRoot}/**/*.md",
        "{workspaceRoot}/.markdownlint-cli2.jsonc"
      ],
      "description": "Lint markdown files across the entire codebase"
    },
    "spell-check": {
      "executor": "nx:run-commands",
      "options": {
        "command": "cspell '*.{ts,tsx,js,jsx,md,yaml,yml,json}' 'scripts/**' 'documentation/**' 'infrastructure/**' 'planning/**' --no-progress",
        "cwd": "{workspaceRoot}"
      },
      "cache": true,
      "inputs": [
        "default",
        "{workspaceRoot}/*.{ts,tsx,js,jsx,md,yaml,yml,json}",
        "{workspaceRoot}/scripts/**",
        "{workspaceRoot}/documentation/**",
        "{workspaceRoot}/infrastructure/**",
        "{workspaceRoot}/planning/**",
        "{workspaceRoot}/cspell.config.yaml"
      ],
      "description": "Check spelling in workspace root files only (excludes projects - use project-level spell-check for those)"
    },
    "code-analysis": {
      "options": {
        "commands": [
          "nx run monorepo:typecheck",
          "nx run monorepo:lint:{args.configuration}",
          "nx run monorepo:markdown-lint:{args.configuration}",
          "nx run monorepo:format:{args.configuration}",
          "nx run monorepo:knip:{args.configuration}",
          "nx run monorepo:spell-check"
        ]
      },
      "description": "Run all static code analysis tools for workspace root (typecheck, lint, format, knip, spell-check, markdown-lint)"
    },
    "terraform": {
      "executor": "nx:run-commands",
      "options": {
        "command": "terraform plan",
        "cwd": "infrastructure/terraform"
      },
      "configurations": {
        "plan": {
          "command": "terraform plan"
        },
        "import": {
          "command": "terraform import -input=false linode_lke_cluster.my_cluster $TF_VAR_linode_kubernetes_engine_cluster_id"
        }
      },
      "defaultConfiguration": "plan",
      "cache": false,
      "description": "Run Terraform commands (plan, import)"
    },
    "typecheck": {
      "description": "Type-check workspace root TypeScript files"
    }
  }
}
